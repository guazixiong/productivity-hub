# Vue 前端管理系统需求文档

## 1. 项目概述

- **目标**：构建基于 Vue 的前端管理系统，覆盖消息推送与智能体调用等核心能力。
- **架构**：前后端分离，当前阶段仅开发前端，所有接口通过 Mock 数据模拟。
- **开发阶段**：
  1. **阶段一（当前）**：前端自研 + Mock 数据，产出需求文档、接口规范、Mock 文件、部署说明。
  2. **阶段二**：后端按接口文档实现真实服务，前端替换 Mock、进行联调并上线。

## 2. 技术栈与通用规范

- **框架**：Vue 3、Vue Router、Pinia（或 Vuex）。
- **UI 组件库**：Element Plus（优先）或 Ant Design Vue。
- **网络层**：Axios，统一封装请求实例、拦截器、错误处理、接口路径集中管理。
- **Mock**：Mock.js 或 MSW。Mock 数据结构需与最终接口一致，并在 `mock/` 目录维护。
- **代码规范**：ESLint + Prettier；提交前运行 `lint` 与 `format`。
- **状态管理与缓存**：
  - 长期参数与用户信息存于 Pinia。
  - 登录态、全局配置缓存支持 `localStorage`/`sessionStorage`。

## 3. 功能模块

### 3.1 用户认证模块

- **功能**：
  - 登录表单（账号、密码 / 支持验证码扩展）。
  - 调用 `/api/auth/login`（POST）进行身份验证。
  - 保存 Token、用户信息，支持刷新恢复。
  - 全局路由守卫：未登录跳转 `Login`，已登录可访问受限路由。
- **数据结构（示例）**：
  ```json
  {
    "token": "string",
    "refreshToken": "string",
    "user": { "id": "string", "name": "string", "roles": ["admin"] }
  }
  ```
- **关键实现**：
  - Axios 请求拦截器自动携带 Token。
  - Pinia `authStore` 负责状态与持久化。
  - Vue Router `beforeEach` 拦截 + 动态路由/权限控制。

### 3.2 全局参数配置模块

- **功能**：
  - 列表展示系统级参数（模块、Key、值、描述）。
  - 支持查询、编辑、批量更新，调用 `/api/config`（GET/PUT）。
  - 本地缓存配置，减少重复请求，可设置缓存时长。
- **交互**：
  - 使用表格 + 抽屉/对话框编辑表单，内置校验。
  - 保存后刷新缓存并提示用户。
- **技术要点**：
  - Pinia `configStore` 存储配置与缓存时间戳。
  - 表单使用 Element Plus Form，提交前本地校验。
  - 失败时提供重试与错误提示。

### 3.3 消息推送模块

- **统一流程**：使用单一表单组件，选择渠道 -> 填写对应参数 -> 调用 `/api/messages/send`，后端按 `channel` 路由请求。
- **子功能**：
  1. **SendGrid 邮件**：收件人、多收件人、主题、富文本内容（集成富文本编辑器），展示发送结果。
  2. **钉钉 Webhook**：配置机器人地址、签名、消息类型（文本/Markdown/链接），展示回执与状态。
  3. **Dify 智能体**：输入智能体 ID、参数、上下文，展示响应内容。
- **附加能力**：
  - 推送历史列表 `/api/messages/history`（分页、筛选渠道/状态/时间）。
  - 多渠道参数 schema 统一管理，便于校验和渲染动态表单。

### 3.4 智能体调用模块

- **功能分块**：
  1. **智能体列表**：调用 `/api/agents` 获取可用智能体，支持搜索、查看详情（描述、版本、能力标签）。
  2. **智能体调用**：在详情页配置输入参数（JSON/Form），支持同步/异步模式，异步模式展示任务状态轮询。
  3. **调用历史**：记录时间、智能体、输入、输出、耗时、状态；支持条件筛选、分页、导出。
- **结果展示**：
  - 文本类结果渲染 Markdown。
  - 结构化数据可视化（表格/图表）。
- **数据存储**：历史记录可先存本地 IndexedDB / localStorage，并预留 `/api/agents/logs`。

## 4. Mock 与接口规范

- **Mock 策略**：
  - 在 `mock/` 下按模块划分文件（`auth.ts`, `config.ts`, `messages.ts`, `agents.ts`）。
  - 使用 Mock.js/MSW 拦截 Axios 请求或提供静态 JSON。
  - Mock 与真实接口共享 TypeScript 类型定义，放在 `src/types/`。
- **接口封装**：
  - `src/services/http.ts`：创建 Axios 实例、请求/响应拦截器、错误处理与重试策略。
  - `src/services/api.ts`：集中管理接口路径与方法（如 `login(params)`、`fetchConfigs()`）。
  - 预留 `adapter` 层（如 `src/adapters/messages.ts`）用于转换表单数据与后端契约，方便后续替换。
- **接口文档**：
  - 使用 Apifox/Swagger 管理，字段含义、示例、状态码必须完整。
  - 前端在文档中同步 Mock 示例，确保后端可直接对照实现。

## 5. 交付物与部署

1. **代码仓库**：完整 Vue 项目（含 `src`, `mock`, `docs`）。
2. **接口对接文档**：在 `docs/api-spec.md`（示例路径）给出接口定义、参数、示例响应。
3. **Mock 数据**：`mock/` 目录下的脚本或 JSON。
4. **部署说明**：`docs/deployment.md` 描述依赖、环境变量、构建脚本（如 `pnpm install && pnpm build`）以及如何切换 Mock/真实接口。

## 6. 注意事项

- 所有需要后端的功能在阶段一必须以 Mock 形式完成，并留好切换开关。
- 重要操作需有错误提示与降级策略（重试、回滚本地状态）。
- 交互上确保表单校验、加载状态、空态提示齐全。
- 接口与数据设计需贴合真实业务，避免后期大幅重构。

